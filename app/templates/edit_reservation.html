{% extends "base.html" %}
{% block content %}
    <h1>Editar Reserva</h1>
    <form method="POST" action="{{ url_for('edit_reservation', reservation_id=reservation.id) }}">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.date.label(class="form-label") }}
            {{ form.date(class="form-control", id="date-field", value=reservation.date) }}
        </div>
        <div class="form-group">
            {{ form.start_time.label(class="form-label") }}
            {{ form.start_time(class="form-control", id="time-field", value=reservation.start_time.strftime('%H:%M')) }}
        </div>
        <div class="form-group">
            {{ form.court_id.label(class="form-label") }}
            {{ form.court_id(class="form-control", id="court-field", value=reservation.court_id) }}
        </div>
        <div class="form-group">
            {{ form.use_type.label(class="form-label") }}
            {{ form.use_type(class="form-control", value=reservation.use_type) }}
        </div>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
    </form>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    document.getElementById('date-field').addEventListener('change', updateCourts);
    document.getElementById('time-field').addEventListener('change', updateCourts);
    document.getElementById('use-type-field').addEventListener('change', updateCourts);

    function updateCourts() {
        var date = document.getElementById('date-field').value;
        var time = document.getElementById('time-field').value;
        var useType = document.getElementById('use-type-field').value;
        if (date && time && useType) {
            fetch(`/get_available_courts?date=${date}&time=${time}&use_type=${useType}`)
                .then(response => response.json())
                .then(data => {
                    var courtField = document.getElementById('court-field');
                    courtField.innerHTML = '';
                    data.courts.forEach(court => {
                        var option = document.createElement('option');
                        option.value = court.id;
                        option.textContent = court.name;
                        courtField.appendChild(option);
                    });
                });
        }
    }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const useTypeField = document.getElementById('use_type');
            const gameTypeField = document.getElementById('game_type');

            const gameTypeDiv = document.getElementById('game_type_div');
            const leagueCategoryDiv = document.getElementById('league_category_div');
            const eliteCategoryDiv = document.getElementById('elite_category_div');
            const academyCategoryDiv = document.getElementById('academy_category_div');
            const player1Div = document.getElementById('player1_div');
            const player2Div = document.getElementById('player2_div');
            const player3Div = document.getElementById('player3_div');
            const player4Div = document.getElementById('player4_div');
            const trainerDiv = document.getElementById('trainer_div');

            function updateFields() {
                const useType = useTypeField.value;
                const gameType = gameTypeField.value;

                if (gameTypeDiv) gameTypeDiv.style.display = 'none';
                if (leagueCategoryDiv) leagueCategoryDiv.style.display = 'none';
                if (eliteCategoryDiv) eliteCategoryDiv.style.display = 'none';
                if (academyCategoryDiv) academyCategoryDiv.style.display = 'none';
                if (player1Div) player1Div.style.display = 'none';
                if (player2Div) player2Div.style.display = 'none';
                if (player3Div) player3Div.style.display = 'none';
                if (player4Div) player4Div.style.display = 'none';
                if (trainerDiv) trainerDiv.style.display = 'none';

                if (useType === 'amistoso') {
                    if (gameTypeDiv) gameTypeDiv.style.display = 'block';
                    if (gameType === 'singles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                    } else if (gameType === 'doubles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                        if (player3Div) player3Div.style.display = 'block';
                        if (player4Div) player4Div.style.display = 'block';
                    }
                } else if (useType === 'liga') {
                    if (leagueCategoryDiv) leagueCategoryDiv.style.display = 'block';
                    if (gameTypeDiv) gameTypeDiv.style.display = 'block';
                    if (gameType === 'singles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                    } else if (gameType === 'doubles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                        if (player3Div) player3Div.style.display = 'block';
                        if (player4Div) player4Div.style.display = 'block';
                    }
                } else if (useType === 'entrenamiento_individual') {
                    if (player1Div) player1Div.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                } else if (useType === 'entrenamiento_grupal') {
                    if (player1Div) player1Div.style.display = 'block';
                    if (player2Div) player2Div.style.display = 'block';
                    if (player3Div) player3Div.style.display = 'block';
                    if (player4Div) player4Div.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                } else if (useType === 'elite') {
                    if (eliteCategoryDiv) eliteCategoryDiv.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                } else if (useType === 'academia_interna') {
                    if (academyCategoryDiv) academyCategoryDiv.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                }
            }

            useTypeField.addEventListener('change', updateFields);
            gameTypeField.addEventListener('change', updateFields);
            updateFields(); 
        });
    </script>
{% endblock %}
