{% extends "base.html" %}
{% block content %}
<h1>Reservar Cancha</h1>
<form method="POST" action="{{ url_for('reserve') }}">
    {{ form.hidden_tag() }}
    
    <div class="form-group">
        {{ form.date.label(class="form-label") }}
        {{ form.date(class="form-control", id="date") }}
    </div>

    <div class="form-group">
        {{ form.start_time.label(class="form-label") }}
        {{ form.start_time(class="form-control", id="start_time") }}
    </div>

    <div class="form-group">
        {{ form.use_type.label(class="form-label") }}
        {{ form.use_type(class="form-control", id="use_type") }}
    </div>

    <div id="game_type_div" class="form-group" style="display: none;">
        {{ form.game_type.label(class="form-label") }}
        {{ form.game_type(class="form-control", id="game_type") }}
    </div>

    <div id="league_category_div" class="form-group" style="display: none;">
        {{ form.league_category.label(class="form-label") }}
        {{ form.league_category(class="form-control", id="league_category") }}
    </div>

    <div id="elite_category_div" class="form-group" style="display: none;">
        {{ form.elite_category.label(class="form-label") }}
        {{ form.elite_category(class="form-control", id="elite_category") }}
    </div>

    <div id="academy_category_div" class="form-group" style="display: none;">
        {{ form.academy_category.label(class="form-label") }}
        {{ form.academy_category(class="form-control", id="academy_category") }}
    </div>

    <div id="players_div" style="display: none;">
        <!-- Player fields here -->
    </div>

    <div id="trainer_div" class="form-group" style="display: none;">
        {{ form.trainer.label(class="form-label") }}
        {{ form.trainer(class="form-control", id="trainer") }}
    </div>

    <div class="form-group">
        {{ form.court_id.label(class="form-label") }}
        {{ form.court_id(class="form-control", id="court_id") }}
    </div>

    <div class="form-group">
        {{ form.is_paid.label(class="form-check-label") }}
        {{ form.is_paid(class="form-check-input", id="is_paid") }}
    </div>

    <div class="form-group">
        {{ form.payment_amount.label(class="form-label") }}
        {{ form.payment_amount(class="form-control", id="payment_amount") }}
    </div>

    <div class="form-group">
        {{ form.comments.label(class="form-label") }}
        {{ form.comments(class="form-control", id="comments") }}
    </div>

    {{ form.submit(class="btn btn-primary") }}
</form>

<script>
    // JavaScript to handle dynamic field updates
    document.getElementById('use_type').addEventListener('change', function() {
        var useType = this.value;
        var gameTypeDiv = document.getElementById('game_type_div');
        var leagueCategoryDiv = document.getElementById('league_category_div');
        var eliteCategoryDiv = document.getElementById('elite_category_div');
        var academyCategoryDiv = document.getElementById('academy_category_div');
        var playersDiv = document.getElementById('players_div');
        var trainerDiv = document.getElementById('trainer_div');

        // Hide all divs initially
        gameTypeDiv.style.display = 'none';
        leagueCategoryDiv.style.display = 'none';
        eliteCategoryDiv.style.display = 'none';
        academyCategoryDiv.style.display = 'none';
        playersDiv.style.display = 'none';
        trainerDiv.style.display = 'none';

        // Show relevant divs based on use type
        if (useType === 'amistoso' || useType === 'liga') {
            gameTypeDiv.style.display = 'block';
            playersDiv.style.display = 'block';
            if (useType === 'liga') {
                leagueCategoryDiv.style.display = 'block';
            }
        } else if (useType === 'entrenamiento_individual' || useType === 'entrenamiento_grupal') {
            trainerDiv.style.display = 'block';
            playersDiv.style.display = 'block';
        } else if (useType === 'elite') {
            eliteCategoryDiv.style.display = 'block';
            trainerDiv.style.display = 'block';
        } else if (useType === 'academia_interna') {
            academyCategoryDiv.style.display = 'block';
            trainerDiv.style.display = 'block';
        }
    });

    // Add event listeners for date, start_time, and use_type to update available courts
    document.getElementById('date').addEventListener('change', updateAvailableCourts);
    document.getElementById('start_time').addEventListener('change', updateAvailableCourts);
    document.getElementById('use_type').addEventListener('change', updateAvailableCourts);

    function updateAvailableCourts() {
        var date = document.getElementById('date').value;
        var startTime = document.getElementById('start_time').value;
        var useType = document.getElementById('use_type').value;

        if (date && startTime && useType) {
            fetch(`/get_available_courts?date=${date}&start_time=${startTime}&use_type=${useType}`)
                .then(response => response.json())
                .then(data => {
                    var courtSelect = document.getElementById('court_id');
                    courtSelect.innerHTML = '';
                    data.forEach(court => {
                        var option = document.createElement('option');
                        option.value = court.id;
                        option.textContent = court.name;
                        courtSelect.appendChild(option);
                    });
                    courtSelect.disabled = false;
                });
        }
    }
</script>
{% endblock %}