{% extends "base.html" %}
{% block content %}
    <h2>Hacer una Reserva</h2>
    <form action="" method="post">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.court_id.label(class="form-label") }}
            {{ form.court_id(class="form-control") }}
        </div> 

        <div class="form-group">
            {{ form.date.label(class="form-label") }}
            {{ form.date(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.start_time.label(class="form-label") }}
            {{ form.start_time(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.end_time.label(class="form-label") }}
            {{ form.end_time(class="form-control") }}
        </div>
        <div class="form-group" id="use_type_div">
            {{ form.use_type.label(class="form-label") }}
            {{ form.use_type(class="form-control", id="use_type") }}
        </div>
        <div class="form-group" id="game_type_div">
            {{ form.game_type.label(class="form-label") }}
            {{ form.game_type(class="form-control", id="game_type") }}
        </div>
        <div class="form-group" id="league_category_div">
            {{ form.league_category.label(class="form-label") }}
            {{ form.league_category(class="form-control", id="league_category") }}
        </div>
        <div class="form-group" id="elite_category_div">
            {{ form.elite_category.label(class="form-label") }}
            {{ form.elite_category(class="form-control", id="elite_category") }}
        </div>
        <div class="form-group" id="academy_category_div">
            {{ form.academy_category.label(class="form-label") }}
            {{ form.academy_category(class="form-control", id="academy_category") }}
        </div>
        <div class="form-group" id="player1_div">
            {{ form.player1.label(class="form-label") }}
            {{ form.player1(class="form-control") }}
            {{ form.player1_is_member.label(class="form-check-label") }}
            {{ form.player1_is_member(class="form-check-input") }}
        </div>
        <div class="form-group" id="player2_div">
            {{ form.player2.label(class="form-label") }}
            {{ form.player2(class="form-control") }}
            {{ form.player2_is_member.label(class="form-check-label") }}
            {{ form.player2_is_member(class="form-check-input") }}
        </div>
        <div class="form-group" id="player3_div">
            {{ form.player3.label(class="form-label") }}
            {{ form.player3(class="form-control") }}
            {{ form.player3_is_member.label(class="form-check-label") }}
            {{ form.player3_is_member(class="form-check-input") }}
        </div>
        <div class="form-group" id="player4_div">
            {{ form.player4.label(class="form-label") }}
            {{ form.player4(class="form-control") }}
            {{ form.player4_is_member.label(class="form-check-label") }}
            {{ form.player4_is_member(class="form-check-input") }}
        </div>
        <div class="form-group" id="trainer_div">
            {{ form.trainer.label(class="form-label") }}
            {{ form.trainer(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.is_paid.label(class="form-check-label") }}
            {{ form.is_paid(class="form-check-input") }}
        </div>
        <div class="form-group">
            {{ form.payment_amount.label(class="form-label") }}
            {{ form.payment_amount(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.comments.label(class="form-label") }}
            {{ form.comments(class="form-control") }}
        </div>
        <button type="submit" class="btn btn-primary">Reservar</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const useTypeField = document.getElementById('use_type');
            const gameTypeField = document.getElementById('game_type');

            // Añadir esta línea para depurar
            console.log('useTypeField:', useTypeField);
            console.log('gameTypeField:', gameTypeField);

            if (!useTypeField || !gameTypeField) {
                console.error('useTypeField or gameTypeField is not defined');
                return;
            }

            const gameTypeDiv = document.getElementById('game_type_div');
            const leagueCategoryDiv = document.getElementById('league_category_div');
            const eliteCategoryDiv = document.getElementById('elite_category_div');
            const academyCategoryDiv = document.getElementById('academy_category_div');
            const player1Div = document.getElementById('player1_div');
            const player2Div = document.getElementById('player2_div');
            const player3Div = document.getElementById('player3_div');
            const player4Div = document.getElementById('player4_div');
            const trainerDiv = document.getElementById('trainer_div');

            function updateFields() {
                const useType = useTypeField.value;
                const gameType = gameTypeField.value;

                // Hide all fields initially
                if (gameTypeDiv) gameTypeDiv.style.display = 'none';
                if (leagueCategoryDiv) leagueCategoryDiv.style.display = 'none';
                if (eliteCategoryDiv) eliteCategoryDiv.style.display = 'none';
                if (academyCategoryDiv) academyCategoryDiv.style.display = 'none';
                if (player1Div) player1Div.style.display = 'none';
                if (player2Div) player2Div.style.display = 'none';
                if (player3Div) player3Div.style.display = 'none';
                if (player4Div) player4Div.style.display = 'none';
                if (trainerDiv) trainerDiv.style.display = 'none';

                // Show fields based on use type
                if (useType === 'amistoso') {
                    if (gameTypeDiv) gameTypeDiv.style.display = 'block';
                    if (gameType === 'singles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                    } else if (gameType === 'doubles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                        if (player3Div) player3Div.style.display = 'block';
                        if (player4Div) player4Div.style.display = 'block';
                    }
                } else if (useType === 'liga') {
                    if (leagueCategoryDiv) leagueCategoryDiv.style.display = 'block';
                    if (gameTypeDiv) gameTypeDiv.style.display = 'block';
                    if (gameType === 'singles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                    } else if (gameType === 'doubles') {
                        if (player1Div) player1Div.style.display = 'block';
                        if (player2Div) player2Div.style.display = 'block';
                        if (player3Div) player3Div.style.display = 'block';
                        if (player4Div) player4Div.style.display = 'block';
                    }
                } else if (useType === 'entrenamiento_individual') {
                    if (player1Div) player1Div.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                } else if (useType === 'entrenamiento_grupal') {
                    if (player1Div) player1Div.style.display = 'block';
                    if (player2Div) player2Div.style.display = 'block';
                    if (player3Div) player3Div.style.display = 'block';
                    if (player4Div) player4Div.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                } else if (useType === 'elite') {
                    if (eliteCategoryDiv) eliteCategoryDiv.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                } else if (useType === 'academia_interna') {
                    if (academyCategoryDiv) academyCategoryDiv.style.display = 'block';
                    if (trainerDiv) trainerDiv.style.display = 'block';
                }
            }

            useTypeField.addEventListener('change', updateFields);
            gameTypeField.addEventListener('change', updateFields);
            updateFields(); // Initial call
        });
    </script>
{% endblock %}
