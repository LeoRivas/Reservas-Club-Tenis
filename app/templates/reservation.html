{% extends "base.html" %}
{% block content %}
<h1>Reservar Cancha</h1>
<form method="POST" action="{{ url_for('reserve') }}">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.date.label(class="form-label") }}
        {{ form.date(class="form-control", id="date") }}
    </div>
    <div class="form-group">
        {{ form.start_time.label(class="form-label") }}
        {{ form.start_time(class="form-control", id="start_time") }}
    </div>
    <div class="form-group">
        {{ form.court_id.label(class="form-label") }}
        <select id="court_id" name="court_id" class="form-control">
            <option value="">Selecciona una hora primero</option>
        </select>
    </div>
    <div class="form-group">
        {{ form.use_type.label(class="form-label") }}
        {{ form.use_type(class="form-control", id="use_type") }}
    </div>
    <div class="form-group" id="game_type_div" style="display: none;">
        {{ form.game_type.label(class="form-label") }}
        {{ form.game_type(class="form-control") }}
    </div>
    <div class="form-group" id="league_category_div" style="display: none;">
        {{ form.league_category.label(class="form-label") }}
        {{ form.league_category(class="form-control") }}
    </div>
    <div class="form-group" id="elite_category_div" style="display: none;">
        {{ form.elite_category.label(class="form-label") }}
        {{ form.elite_category(class="form-control") }}
    </div>
    <div class="form-group" id="academy_category_div" style="display: none;">
        {{ form.academy_category.label(class="form-label") }}
        {{ form.academy_category(class="form-control") }}
    </div>
    <div id="players_div" style="display: none;">
        <div class="form-group">
            {{ form.player1.label(class="form-label") }}
            {{ form.player1(class="form-control", value=current_user.username, readonly=True) }}
        </div>
        <div class="form-group">
            {{ form.player1_is_member.label(class="form-check-label") }}
            {{ form.player1_is_member(class="form-check-input") }}
        </div>
        <div class="form-group">
            {{ form.player2.label(class="form-label") }}
            {{ form.player2(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.player2_is_member.label(class="form-check-label") }}
            {{ form.player2_is_member(class="form-check-input") }}
        </div>
        <div class="form-group" id="player3_div" style="display: none;">
            {{ form.player3.label(class="form-label") }}
            {{ form.player3(class="form-control") }}
        </div>
        <div class="form-group" id="player3_is_member_div" style="display: none;">
            {{ form.player3_is_member.label(class="form-check-label") }}
            {{ form.player3_is_member(class="form-check-input") }}
        </div>
        <div class="form-group" id="player4_div" style="display: none;">
            {{ form.player4.label(class="form-label") }}
            {{ form.player4(class="form-control") }}
        </div>
        <div class="form-group" id="player4_is_member_div" style="display: none;">
            {{ form.player4_is_member.label(class="form-check-label") }}
            {{ form.player4_is_member(class="form-check-input") }}
        </div>
    </div>
    <div class="form-group" id="trainer_div" style="display: none;">
        {{ form.trainer.label(class="form-label") }}
        {{ form.trainer(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.is_paid.label(class="form-check-label") }}
        {{ form.is_paid(class="form-check-input") }}
    </div>
    <div class="form-group">
        {{ form.payment_amount.label(class="form-label") }}
        {{ form.payment_amount(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.comments.label(class="form-label") }}
        {{ form.comments(class="form-control") }}
    </div>
    <button type="submit" class="btn btn-primary">Reservar</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function updateAvailableCourts() {
        var date = document.getElementById('date').value;
        var startTime = document.getElementById('start_time').value;
        var useType = document.getElementById('use_type').value;

        if (date && startTime && useType) {
            fetch('/get_available_courts?date=' + date + '&start_time=' + startTime + '&use_type=' + useType)
                .then(response => response.json())
                .then(data => {
                    var courtSelect = document.getElementById('court_id');
                    courtSelect.innerHTML = '';
                    var defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Selecciona una cancha';
                    courtSelect.appendChild(defaultOption);
                    data.forEach(function(court) {
                        var option = document.createElement('option');
                        option.value = court.id;
                        option.textContent = court.name;
                        courtSelect.appendChild(option);
                    });
                    courtSelect.disabled = false;
                })
                .catch(error => console.error('Error:', error));
        }
    }

    function updateFields() {
        var useType = document.getElementById('use_type').value;
        document.getElementById('game_type_div').style.display = (useType === 'liga' || useType === 'amistoso') ? 'block' : 'none';
        document.getElementById('league_category_div').style.display = useType === 'liga' ? 'block' : 'none';
        document.getElementById('elite_category_div').style.display = useType === 'entrenamiento' ? 'block' : 'none';
        document.getElementById('academy_category_div').style.display = useType === 'academia' ? 'block' : 'none';
        var showPlayers = (useType === 'amistoso' || useType === 'liga');
        var showTrainer = (useType === 'entrenamiento' || useType === 'academia');
        document.getElementById('players_div').style.display = showPlayers ? 'block' : 'none';
        document.getElementById('trainer_div').style.display = showTrainer ? 'block' : 'none';
        var gameType = document.getElementById('game_type').value;
        var isDoubles = gameType === 'dobles';
        document.getElementById('player3_div').style.display = isDoubles ? 'block' : 'none';
        document.getElementById('player3_is_member_div').style.display = isDoubles ? 'block' : 'none';
        document.getElementById('player4_div').style.display = isDoubles ? 'block' : 'none';
        document.getElementById('player4_is_member_div').style.display = isDoubles ? 'block' : 'none';
    }

    document.getElementById('date').addEventListener('change', updateAvailableCourts);
    document.getElementById('start_time').addEventListener('change', updateAvailableCourts);
    document.getElementById('use_type').addEventListener('change', function() {
        updateAvailableCourts();
        updateFields();
    });
    document.getElementById('game_type').addEventListener('change', updateFields);

    // Inicializar el select de canchas como deshabilitado
    document.getElementById('court_id').disabled = true;

    updateFields(); // Llamar a esto inicialmente para configurar los campos correctos al cargar la p√°gina
});
</script>