<form method="POST" action="{{ url_for('reserve') }}">
    {{ form.hidden_tag() }}
    
    <div class="form-group">
        {{ form.date.label }}
        {{ form.date(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.start_time.label }}
        {{ form.start_time(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.use_type.label }}
        {{ form.use_type(class="form-control") }}
    </div>

    <div id="player1-group" class="form-group">
        {{ form.player1.label }}
        {{ form.player1(class="form-control") }}
        {{ form.player1_is_member.label }}
        {{ form.player1_is_member() }}
    </div>

    <div id="trainer-group" class="form-group" style="display: none;">
        {{ form.trainer.label }}
        {{ form.trainer(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.court_id.label }}
        {{ form.court_id(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.is_paid.label }}
        {{ form.is_paid() }}
    </div>

    <div class="form-group">
        {{ form.payment_amount.label }}
        {{ form.payment_amount(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.comments.label }}
        {{ form.comments(class="form-control") }}
    </div>

    <div class="form-group">
        {{ form.submit(class="btn btn-primary") }}
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('date');
    const startTimeInput = document.getElementById('start_time');
    const useTypeInput = document.getElementById('use_type');
    const courtSelect = document.getElementById('court_id');
    const trainerGroup = document.getElementById('trainer-group');

    function updateAvailableCourts() {
        const date = dateInput.value;
        const startTime = startTimeInput.value;
        const useType = useTypeInput.value;

        if (date && startTime && useType) {
            fetch(`/get_available_courts?date=${date}&start_time=${startTime}&use_type=${useType}`)
                .then(response => response.json())
                .then(courts => {
                    courtSelect.innerHTML = '<option value="">Selecciona una cancha</option>';
                    courts.forEach(court => {
                        const option = new Option(court.name, court.id);
                        courtSelect.add(option);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    courtSelect.innerHTML = '<option value="">Error al cargar canchas</option>';
                });
        }
    }

    function updateFormFields() {
        const useType = useTypeInput.value;
        trainerGroup.style.display = (useType === 'entrenamiento_individual' || useType === 'entrenamiento_grupal') ? 'block' : 'none';
    }

    dateInput.addEventListener('change', updateAvailableCourts);
    startTimeInput.addEventListener('change', updateAvailableCourts);
    useTypeInput.addEventListener('change', function() {
        updateAvailableCourts();
        updateFormFields();
    });

    // Inicializar campos
    updateFormFields();
    if (dateInput.value && startTimeInput.value && useTypeInput.value) {
        updateAvailableCourts();
    }
});
</script>